<html>
<head>
  <title>Google Book Words</title>
    <style>
        .answer {
            min-height: 50px
        }
        section{
          padding: 10px;
          margin-bottom: 12px
        }
        #title {
          position: absolute;
          padding: 20px;
          font-size: 64px;
          font-weight: bolder;
          color: white;
          top: 50px;
          left: 0px;
          text-shadow: -2px 0 black, 0 2px black, 5px 0 black, 0 -2px black
        }
        #title .authors {
          padding: 20px;
          font-size: 32px;
          font-weight: bolder;
          color: #DDD;
          text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black
        }
        #tweets {
          min-height: 300px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow.min.css">
</head>
<body>

  <div class="parallax-container"  style="height:325px">
    <div class="parallax">
      <img src="http://mms.businesswire.com/media/20150722005491/en/239161/5/c_scale,e_brightness:-62,w_1000/v1447038536/ZAYO_Group_SPOT.jpg">
      <h1 id="title">Zayo / Big Data: Business Intelligience Collaboration
        <div class="authors">by Karen Blakemore, Fadhil Suhendi & Zhili Yang</div>
      </h1>
    </div>
  </div>

  <div class="section white container flow-text">
      <div class="switch">
        Source Code
        <label>
          <input type="checkbox">
          <span class="lever"></span>
        </label>
      </div>

      <div id="questions" class="col s10 collection">
      </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/chartist/0.9.4/chartist.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
  <script>

function toggleSourecode(){
  $('pre').each(function(){
    if ($(this).height()){
        $(this).attr('data-height', $(this).height())
        $(this).height(0)
    } else {
      $(this).height($(this).attr('data-height'))
    }
  })
}
$('.switch input').click(toggleSourecode)

function tsv2jsonProfile(rawdata){
  var lines = rawdata.trim().split('\n')
  var rows = _.rest(lines)
  var row2 = _.drop(rows,5)
  return _.map(row2, function(row){
    var toks = row.split('\t')
    return {"ID/Name": toks[0], "Industry": toks[1], "Vertical": toks[2], "Total (BRR)": toks[3],"Product A Rank":toks[4],"Product A Total BRR":toks[5],"Product B Rank":toks[6],"Product B Total BRR":toks[7],"Product C Rank":toks[8],"Product C Total BRR":toks[9],"Product D Rank":toks[10],"Product D Total BRR":toks[11],"Product E Rank":[12],"Product F - Metro Rank":toks[13]} 
  })
}

function tsv2jsonServices(rawdata){
  var lines = rawdata.trim().split('\n')
  var rows = _.rest(lines)
  rows=_.drop(rows, 7)
  return _.map(rows, function(row){
    var toks = row.split('\t')
    return {"ID/Name": toks[0], "Service Count": toks[1], "Service ID": toks[2], "Product": toks[3], "Total MRR": toks[4], "Term": toks[5], "Bandwidth": toks[6], "State A": toks[7], "State Z": toks[8]}
  })
}

var profileItems = []
var servicesItems = []

function loadDataThenRunSolutions() {
  $.get('/data/customer_accounts_profile.tsv')
    .done(function(data){ console.log('got profile data 2')   
      profileItems = tsv2jsonProfile(data)
      console.log('profileItems[0]', profileItems[0])
    $.get('/data/customer_accounts_services.tsv')
      .done(function(data){
        servicesItems = tsv2jsonServices(data)
        console.log('servicesItems[0]', servicesItems[0])
        analyze()
      })
  })
  .fail(function(err){
    console.error(err)
  })
}

loadDataThenRunSolutions()

function ask(text, func){
  var answer = func()

  // html element to display the answer
  var answerHtml = '<div class="collection-item answer">' +
      '<h4>' + text + '</h4>' +
      '<div>' + answer + '</div>' +
      '<pre><code>' + func.toString() + '</code></pre>' +
    '</div>'

  // append to #quetions
  $('#questions').append(answerHtml)
}

function analyze() {
  console.log('In analyze!')
  ask("What is the relationship between product and bandwidth?", func1)
  ask("Fadhil's Question", func2)
  ask("What are the relationships between industries and products?", func3)

  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  })
  toggleSourecode()
}

// What is the relationship between product and bandwidth
function func1() {
  bandwidths = _.chain(servicesItems)
    .groupBy('Bandwidth')
    .mapValues(function(b) { 
      return _.chain(b)
        .groupBy('Product')
        .mapValues('length')
        .defaults({'Product A': 0}, {'Product B': 0}, {'Product C': 0}, {'Product D': 0},
          {'Product E': 0}, {'Product F': 0}, {'Other': 0})
        .values()
        .value()
    })
    .value()
     
  console.log('bandwidths', bandwidths)
  console.log('keys', _.keys(bandwidths))
  console.log('values', _.values(bandwidths))

  new Chartist.Bar('.ct-chart', {
    labels: _.keys(bandwidths),
    series: _.values(bandwidths)
    }, {
      seriesBarDistance: 10,
      reverseData: true,
      horizontalBars: true,
      axisY: {
        offset: 70
      }
  })

  return('Done')
}

function func2() {
  return "TBD"
}

function func3() {
  return "TBD"
}

// initialize the parallax effect
$(document).ready(function(){
    $('.parallax').parallax()
})

  </script>

</body>
</html>
